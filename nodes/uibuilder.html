<!--
  Copyright (c) 2017 Julian Knight (Totally Information)

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/javascript">
    RED.nodes.registerType( 'uibuilder', {
        category: 'UI Builder',
        color: '#E6E0F8',
        defaults: {
            name: { value: '' },
            url: { value: 'uibuilder' }, // TODO: needs validation
            fwdInMessages: { value: false },
        },
        inputs: 1,
        outputs: 1,
        icon: "ui_template.png",
        paletteLabel: 'UI Builder',
        label: function() { return this.url || this.name || 'UI Builder'; },
        oneditprepare: function() {
            $("#node-input-fwdInMessages").prop('checked', this.fwdInMessages)
            $("#node-input-customFoldersReqd").prop('checked', this.customFoldersReqd)
        },
        //oneditsave: function() { },
        //oneditresize: function(size) { },
        // Do any setup when node added to palette
        //onpaletteadd: function() { },
    });
</script>

<script type="text/x-red" data-template-name="uibuilder">
    <!-- Node Name -->
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name">
    </div>

    <!-- Home "page" id - defines the URL used -->
    <div class="form-row">
        <label for="node-input-url"><i class="fa fa-tag"></i> URL</label>
        <input type="text" id="node-input-url">
    </div>

    <div class="form-row">
        <input type="checkbox" id="node-input-fwdInMessages" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-fwdInMessages" style="width: 70%;">Forward received messages direct to output?</label>
    </div>
</script>

<script type="text/x-red" data-help-name="uibuilder">
    <p>Creates a UI at a <a href="/uibuilder">given URL</a></p>
    <p>
        This node can be used to create a dynamic user interface that can receive and send back messages to Node-RED using a websocket connection.
        It creates a file/folder structure for you that can be used to deliver static resources (html, css, js, images, etc).
    </p>

    <h3>Inputs</h3>
    <dl class="message-properties">
        <dt class="optional">payload <span class="property-type">(string | buffer)</span></dt>
        <dd> Optionally, the payload of the message to publish. </dd>
        <dt class="optional">topic <span class="property-type">(string)</span></dt>
        <dd> Optionally, the MQTT topic to use. Takes preference over the topic defined in settings.</dd>
    </dl>

    <h3>Outputs</h3>
    <ol class="node-ports">
        <li>Standard output
            <dl class="message-properties">
                <dt>_msgcounter <span class="property-type">(integer)</span></dt>
                <dd>
                    The number of messages received by the node instance since either the last reset of Node-RED or the last deployment of the node instance.
                </dd>
                <dt>payload <span class="property-type">(string | buffer)</span></dt>
                <dd>
                    A copy of any inbound payload unless altered by the front-end page.
                </dd>
                <dt>topic <span class="property-type">(string)</span></dt>
                <dd>
                    A copy of any inbound topic if present. Otherwise, the topic from the node's settings. Could be changed by the front-end
                    page but it really isn't recommended.
                </dd>
            </dl>
        </li>
    </ol>

    <h3>Node Settings</h3>
    <dl>
        <dt>Name</dt>
        <dd>A short description shown in the admin interface</dd>
        <dt>Topic</dt>
        <dd>A topic name to use if the incoming msg does not contain one.</dd>
        <dt>URL</dt>
        <dd>
            The URL path that the resulting page and other resources will be served from.
            Must be unique across Node-RED. Will also use the Node-RED scheme (http/https)
            and port. Will also be prefixed by the Node-RED setting
        </dd>
        <dt>Forward received messages direct to output?</dt>
        <dd>
            Forward's a copy of every received message direct to the output.
            Adds the topic from the above setting if one isn't present in the msg.
            <p>
                <i>Note</i> that this may result in multiple output messages if your front-end
                code also auto-sends inbound messages.
            </p>
        </dd>
    </dl>

    <h3>Node-RED Settings</h3>
    <p>
        This node is able to use some settings from <code>settings.js</code>.
        The main setting object is <code>uibuilder</code>
    </p>
    <dl>
        <dt>uibuilder.userVendorPackages <span class="property-type">(list)</span></dt>
        <dd>
            A list of package names that must match the folder name of an npm package
            installed in the <code>userDir</code> of Node-RED. These will be added to
            the list of statically served resource folders <b>if</b> the local <code>src</code>
            folder is being used and the "Use resources in custom folder?" setting is checked.
        </dd>
    </dl>

    <h3>File/Folder Structure</h3>
    <p>
        For more information, see the GitHub page for <a href="https://github.com/TotallyInformation/node-red-contrib-uibuilder">node-red-contrib-uibuilder</a>
    </p>


    <h3>Details</h3>
    <p>
        For more information, see the GitHub page for <a href="https://github.com/TotallyInformation/node-red-contrib-uibuilder">node-red-contrib-uibuilder</a>
    </p>
</script>
