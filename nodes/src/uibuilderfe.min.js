"use strict";if("undefined"!=typeof require&&void 0===io)var io=require("socket.io-client");(function(){function e(e,t){"string"!=typeof t&&(console.warn("makeMeAnObject:WARNING: attribute parameter must be a string and not: "+typeof t),t="payload");var i={};return"object"==typeof e?i=e:null!==e&&(i[t]=e),i}var t=this,i=t.uibuilder,n=function(){var t=this;return t.version="0.4.8",t.debug=!1,t.uiDebug=function(e,i){if(t.debug){switch(this.myLog={},e){case"error":this.myLog=console.error;break;case"warn":this.myLog=console.warn;break;case"info":this.myLog=console.info;break;case"dir":this.myLog=console.dir;break;default:this.myLog=console.log}this.myLog(i)}},t.me=function(){return!0===t.debug?t:"uibuilderfe.js Version: "+t.version},t.setIOnamespace=function(){var e="/"+window.location.pathname.split("/").filter(function(e){return""!==e.trim()}).join("/");return t.uiDebug("log","uibuilderfe: IO Namespace: "+e),e},t.msg={},t.ctrlMsg={},t.sentMsg={},t.msgsSent=0,t.msgsReceived=0,t.msgsCtrl=0,t.ioChannels={control:"uiBuilderControl",client:"uiBuilderClient",server:"uiBuilder"},t.retryMs=2e3,t.retryFactor=1.5,t.timerid=null,t.ioNamespace=t.setIOnamespace(),t.ioPath="/uibuilder/socket.io",t.ioTransport=["polling","websocket"],t.ioConnected=!1,t.allowScript=!0,t.allowStyle=!0,t.removeScript=!0,t.removeStyle=!0,t.set=function(e,i){t[e]=i,t.uiDebug("log","uibuilderfe: prop set - prop: "+e+", val: "+("object"==typeof i)?JSON.stringify(i):i),t.emit(e,i)},t.socket=io(t.ioNamespace,{path:t.ioPath,transports:t.ioTransport}),t.checkConnect=function(e,i){var n=n++||1;t.uiDebug("log","checkConnect. Depth: ",n," , Delay: ",e,", Factor: ",i),t.timerid&&window.clearTimeout(t.timerid),t.timerid=window.setTimeout(function(){t.uiDebug("log","checkConnect timeout. SIO reconnect attempt, timeout: "+e+", depth: "+n),t.socket.close(),t.socket.connect(),t.timerid=null,t.checkConnect(e*i,i)},e)},t.socket.on("connect",function(){t.uiDebug("log","uibuilderfe: SOCKET CONNECTED - Namespace: "+t.ioNamespace),t.set("ioConnected",!0),t.timerid&&(window.clearTimeout(t.timerid),t.timerid=null)}),t.socket.on(t.ioChannels.server,function(i){t.uiDebug("info","uibuilderfe: socket.on.server - msg received - Namespace: "+t.ioNamespace),t.uiDebug("dir",i),i=e(i,"payload"),t.allowScript&&i.hasOwnProperty("script")&&(t.newScript(i.script),t.removeScript&&delete i.script),t.allowStyle&&i.hasOwnProperty("style")&&(t.newStyle(i.style),t.removeStyle&&delete i.style),t.set("msg",i),t.set("msgsReceived",t.msgsReceived+1)}),t.socket.on(t.ioChannels.control,function(e){t.uiDebug("info","uibuilder:socket.on.control - msg received - Namespace: "+t.ioNamespace),t.uiDebug("dir",e),null===e?e={}:"object"!=typeof e&&(e={payload:e}),e.hasOwnProperty("debug")&&(t.debug=e.debug),t.set("ctrlMsg",e),t.set("msgsCtrl",t.msgsCtrl+1)}),t.socket.on("disconnect",function(e){t.uiDebug("log","SOCKET DISCONNECTED - Namespace: "+t.ioNamespace+", Reason: "+e),t.set("ioConnected",!1),"io server disconnect"===e&&t.checkConnect(t.retryMs,t.retryFactor)}),t.send=function(e,i=t.ioChannels.client){t.uiDebug("info","uibuilderfe: msg sent - Namespace: "+t.ioNamespace+", Channel: "+i),t.uiDebug("dir",e),t.set("sentMsg",e),i===t.ioChannels.client?t.set("msgsSent",t.msgsSent+1):t.set("msgsCtrl",t.msgsCtrl+1),t.socket.emit(i,e)},t.events={},t.emit=function(e){var i=t.events[e];if(i)for(var n=Array.prototype.slice.call(arguments,1),o=0;o<i.length;o++)i[o].apply(t,n)},t.newScript=function(e){if(!0===t.allowScript&&""!==e&&void 0!==e){t.uiDebug("log","uibuilderfe: newCode - script: "+e);var i=document.createElement("script");i.type="text/javascript",i.defer=!0,i.textContent=e,document.getElementsByTagName("body")[0].appendChild(i)}},t.newStyle=function(e){if(!0===t.allowStyle&&""!==e&&void 0!==e){t.uiDebug("log","uibuilderfe: newStyle - style: "+e);var i=document.createElement("style");i.textContent=e,document.getElementsByTagName("head")[0].appendChild(i)}},t.uiReturn={set:function(e,i){-1===["version","msg","ctrlMsg","sentMsg","msgsSent","msgsReceived","msgsCtrl","ioChannels","retryMs","retryFactor","timerid","ioNamespace","ioPath","ioTransport","ioConnected","set","get","debug","send","onChange","socket","checkConnect","events","emit","uiReturn"].indexOf(e)?t.set(e,i):t.uiDebug("warn",'uibuilderfe:uibuilder:set: "'+e+'" is in list of excluded attributes, not set')},get:function(e){return t[e]},onChange:function(e,i){t.events[e]?t.events[e].push(i):t.events[e]=[i]},msg:t.msg,send:t.send,sendCtrl:function(e){t.send(e,t.ioChannels.control)},debug:function(e){if(void 0===e)return t.debug;"boolean"==typeof e&&(t.debug=e)},uiDebug:t.uiDebug,me:t.me},t.checkConnect(t.retryMs,t.retryFactor),t.uiReturn}.call(t);n.noConflict=function(){return t.uibuilder=i,n},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.uibuilder=n):t.uibuilder=n}).call(this);