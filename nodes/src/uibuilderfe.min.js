"use strict";(function(){function e(e,t){"string"!=typeof t&&(console.warn("makeMeAnObject:WARNING: attribute parameter must be a string and not: "+typeof t),t="payload");var n={};return"object"==typeof e?n=e:null!==e&&(n[t]=e),n}var t=this,n=t.uibuilder,i=function(){var t=this;return t.version="0.4.6",t.debug=!1,t.uiDebug=function(e,n){if(t.debug){switch(this.myLog={},e){case"error":this.myLog=console.error;break;case"warn":this.myLog=console.warn;break;case"info":this.myLog=console.info;break;case"dir":this.myLog=console.dir;break;default:this.myLog=console.log}this.myLog(n)}},t.me=function(){return!0===t.debug?t:"uibuilderfe.js Version: "+t.version},t.setIOnamespace=function(){var e=window.location.pathname.split("/"),n=e.pop();return""===n&&(n=e.pop()),t.uiDebug("log","uibuilderfe: IO Namespace: /"+n),"/"+n},t.msg={},t.ctrlMsg={},t.sentMsg={},t.msgsSent=0,t.msgsReceived=0,t.msgsCtrl=0,t.ioChannels={control:"uiBuilderControl",client:"uiBuilderClient",server:"uiBuilder"},t.retryMs=2e3,t.retryFactor=1.5,t.timerid=null,t.ioNamespace=t.setIOnamespace(),t.ioPath="/uibuilder/socket.io",t.ioTransport=["polling","websocket"],t.ioConnected=!1,t.set=function(e,n){t[e]=n,t.uiDebug("log","uibuilderfe: prop set - prop: "+e+", val: "+n),t.emit(e,n)},t.socket=io(t.ioNamespace,{path:t.ioPath,transports:t.ioTransport}),t.checkConnect=function(e,n){var i=i++||1;t.uiDebug("log","checkConnect. Depth: ",i," , Delay: ",e,", Factor: ",n),t.timerid&&window.clearTimeout(t.timerid),t.timerid=window.setTimeout(function(){t.uiDebug("log","checkConnect timeout. SIO reconnect attempt, timeout: "+e+", depth: "+i),t.socket.close(),t.socket.connect(),t.timerid=null,t.checkConnect(e*n,n)},e)},t.socket.on("connect",function(){t.uiDebug("log","uibuilderfe: SOCKET CONNECTED - Namespace: "+t.ioNamespace),t.set("ioConnected",!0),t.timerid&&(window.clearTimeout(t.timerid),t.timerid=null)}),t.socket.on(t.ioChannels.server,function(n){t.uiDebug("info","uibuilderfe: socket.on.server - msg received - Namespace: "+t.ioNamespace),t.uiDebug("dir",n),(n=e(n,"payload")).hasOwnProperty("code")&&t.newCode(n.code),n.hasOwnProperty("style")&&t.newStyle(n.style),t.set("msg",n),t.set("msgsReceived",t.msgsReceived+1)}),t.socket.on(t.ioChannels.control,function(e){t.uiDebug("info","uibuilder:socket.on.control - msg received - Namespace: "+t.ioNamespace),t.uiDebug("dir",e),null===e?e={}:"object"!=typeof e&&(e={payload:e}),t.set("ctrlMsg",e),t.set("msgsCtrl",t.msgsCtrl+1)}),t.socket.on("disconnect",function(e){t.uiDebug("log","SOCKET DISCONNECTED - Namespace: "+t.ioNamespace+", Reason: "+e),t.set("ioConnected",!1),"io server disconnect"===e&&t.checkConnect(t.retryMs,t.retryFactor)}),t.send=function(e){t.uiDebug("info","uibuilderfe: msg sent - Namespace: "+t.ioNamespace),t.uiDebug("dir",e),t.set("sentMsg",e),t.set("msgsSent",t.msgsSent+1),t.socket.emit(t.ioChannels.client,e)},t.events={},t.emit=function(e){var n=t.events[e];if(n)for(var i=Array.prototype.slice.call(arguments,1),o=0;o<n.length;o++)n[o].apply(t,i)},t.newCode=function(e){if(""!==e&&void 0!==e){"array"==typeof e&&e.join("\n"),t.uiDebug("info","uibuilderfe: newCode - code: "+e);var n=document.createElement("script");n.type="text/javascript",n.defer=!0,n.textContent=e,t.uiDebug("dir",n),document.getElementsByTagName("body")[0].appendChild(n)}},t.newStyle=function(e){t.uiDebug("info","uibuilderfe: newStyle - style: "+e);var n=document.createElement("style");n.textContent=e,t.uiDebug("dir",n),document.getElementsByTagName("head")[0].appendChild(n)},t.uiReturn={set:function(e,n){-1===["version","msg","ctrlMsg","sentMsg","msgsSent","msgsReceived","msgsCtrl","ioChannels","retryMs","retryFactor","timerid","ioNamespace","ioPath","ioTransport","ioConnected","set","get","debug","send","onChange","socket","checkConnect","events","emit","uiReturn"].indexOf(e)?t.set(e,n):t.uiDebug("warn",'uibuilderfe:uibuilder:set: "'+e+'" is in list of excluded attributes, not set')},get:function(e){return t[e]},onChange:function(e,n){t.events[e]?t.events[e].push(n):t.events[e]=[n]},msg:t.msg,send:t.send,debug:function(e){if(void 0===e)return t.debug;"boolean"==typeof e&&(t.debug=e)},uiDebug:t.uiDebug,me:t.me},t.uiReturn}.call(t);i.noConflict=function(){return t.uibuilder=n,i},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=i),exports.uibuilder=i):t.uibuilder=i}).call(this);